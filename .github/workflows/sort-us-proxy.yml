name: Sort Domain Suffixes

on:
  push:
    paths:
      - 'us-proxy.txt'  # è¯·æ›¿æ¢ä¸ºå®žé™…æ–‡ä»¶è·¯å¾„

jobs:
  sort-domains:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # ç¡®ä¿å¯ä»¥æ‰§è¡Œ git æ“ä½œ

    - name: Sort domains
      run: |
        # å¤„ç†æ–‡ä»¶ä¸‰æ­¥æ›²ï¼š
        # 1. ç§»é™¤å‰ç¼€ 2. æŽ’åº 3. é‡æ–°æ·»åŠ å‰ç¼€
        input_file="us-proxy.txt"  # æ›¿æ¢ä¸ºå®žé™…æ–‡ä»¶è·¯å¾„
        temp_file=$(mktemp)
        
        # å¤„ç†å¹¶æŽ’åº
        sed 's/^DOMAIN-SUFFIX, //' "$input_file" | sort -d > "$temp_file"
        
        # é‡æ–°æ·»åŠ å‰ç¼€å¹¶è¦†ç›–åŽŸæ–‡ä»¶
        sed 's/^/DOMAIN-SUFFIX, /' "$temp_file" > "$input_file"
        rm -f "$temp_file"

    - name: Commit changes
      id: commit
      run: |
        if git diff --quiet; then
          echo "::set-output name=has_changes::false"
        else
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add -A
          git commit -m "ðŸ”€ Auto-sort domain suffixes"
          echo "::set-output name=has_changes::true"
        fi

    - name: Push changes
      if: steps.commit.outputs.has_changes == 'true'
      uses: ad-m/github-push-action@master
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        branch: ${{ github.ref }}